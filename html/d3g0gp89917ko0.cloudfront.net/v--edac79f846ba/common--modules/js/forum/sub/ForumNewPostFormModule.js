WIKIDOT.modules.ForumNewPostFormModule={};WIKIDOT.modules.ForumNewPostFormModule.listeners={preview:function(b){var a=OZONE.utils.formToArray("new-post-form");OZONE.ajax.requestModule("forum/ForumPreviewPostModule",a,WIKIDOT.modules.ForumNewPostFormModule.callbacks.preview)},cancel:function(b){var a=$("new-post-form-container");a.parentNode.removeChild(a);$("new-post-button").style.display="";WIKIDOT.Editor.shutDown()},closePreview:function(a){$("new-post-preview-div").style.display="none"},save:function(c){var b=OZONE.utils.formToArray("new-post-form");b.action="ForumAction";b.event="savePost";var a=new OZONE.dialogs.WaitBox();a.content="Posting now...";a.show();OZONE.ajax.requestModule(null,b,WIKIDOT.modules.ForumNewPostFormModule.callbacks.save)}};WIKIDOT.modules.ForumNewPostFormModule.callbacks={preview:function(c){if(!WIKIDOT.utils.handleError(c)){return}var b=$("new-post-preview-div");var a=b.getElementsByTagName("div");$j(a[0]).html(c.body);b.style.visibility="hidden";b.style.display="block";b.style.visibility="visible";OZONE.visuals.scrollTo("new-post-preview-div")},save:function(e){if(e.status=="form_errors"){var b="The data you have submitted contains following errors:<ul>";var g=e.formErrors;for(var c in g){b+="<li>"+g[c]+"</li>"}b+="</ul>";var a=new OZONE.dialogs.ErrorDialog();a.content=b;a.show();keyBindNewPost();return}if(e.status=="need_captcha"){keyBindNewPost();$j("#edit-post-captcha").html(e.captcha);$j("body").scrollTo("#edit-post-captcha");$j("#edit-post-form input[name=mathCaptchaResult]").focus();OZONE.dialog.cleanAll();return}if(!WIKIDOT.utils.handleError(e)){return}var a=new OZONE.dialogs.SuccessBox();a.content="Your post has been saved.";a.show();var f="post-"+e.postId;var d=window.location.href.replace(/#.*$/,"");d=d.replace(/\/$/,"");d="/"+WIKIREQUEST.info.requestPageName;$j("#np-text").val("");if(!WIKIREQUEST.info.requestPageName.match(/^forum:thread$/)){if(!d.match(/comments\/show/)){d+="/comments/show";d+="#post-"+e.postId;setTimeout(function(){window.location.href=d;window.location.reload()},100)}else{var f="post-"+e.postId;setTimeout(function(){window.location.hash=f;window.location.reload()},100)}}else{var f="post-"+e.postId;setTimeout(function(){window.location.hash=f;window.location.reload()},100)}}};WIKIDOT.modules.ForumNewPostFormModule.init=function(){if($("np-text")){keyBindNewPost();(function(a){a('.guest-commenting input[title!=""]').each(function(){a(this).wrap("<div/>");a(this).hint(a(this).attr("title"))})})(jQuery)}};$j(WIKIDOT.modules.ForumNewPostFormModule.init);